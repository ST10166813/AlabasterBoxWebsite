@{
    ViewBag.Title = "Donate";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
<style>
html, body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #000000, #1a1a1a);
    color: #fff;
    min-height: 100vh;
    overflow-x: hidden;
}

.container {
    max-width: 850px;
    margin: 3rem auto;
    padding: 2rem;
    text-align: center;
}

h1 {
    font-size: 2.5rem;
    font-weight: 700;
    color: #FFD700;
    margin-bottom: 2rem;
}

form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,215,0,0.3);
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 6px 20px rgba(0,0,0,0.4);
}

label {
    font-weight: 600;
    text-align: left;
    color: #FFD700;
}

input, select, textarea {
    padding: 0.8rem;
    border-radius: 10px;
    border: 1px solid rgba(255,215,0,0.4);
    background: rgba(0,0,0,0.35);
    color: #fff;
    outline: none;
    font-size: 1rem;
}

textarea {
    resize: none;
    height: 100px;
}

button {
    background: #FFD700;
    border: none;
    border-radius: 999px;
    color: #000;
    font-weight: 700;
    font-size: 1.1rem;
    padding: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 1rem;
}

button:hover {
    background: #e6c200;
    transform: scale(1.03);
}

.bank-details {
    text-align: left;
    background: rgba(255,255,255,0.08);
    padding: 1rem 1.5rem;
    border-radius: 12px;
    margin-top: 1rem;
}

.hidden {
    display: none;
}

footer {
    margin-top: 3rem;
    text-align: center;
    font-size: 0.9rem;
    color: #999;
}

/* ✅ Toast Notification */
.toast {
    visibility: hidden;
    min-width: 300px;
    background-color: #333;
    color: white;
    text-align: center;
    border-radius: 12px;
    padding: 15px;
    position: fixed;
    z-index: 999;
    left: 50%;
    bottom: 30px;
    transform: translateX(-50%);
    font-size: 1rem;
    opacity: 0;
    transition: opacity 0.5s, bottom 0.5s;
}
.toast.show {
    visibility: visible;
    opacity: 1;
    bottom: 50px;
}
.toast.success { background-color: #28a745; }
.toast.error { background-color: #dc3545; }
</style>
}

<div class="container">
    <h1>Support the Ministry</h1>

    <form id="donationForm">
        <label for="name">Full Name</label>
        <input type="text" id="name" placeholder="Enter your full name" required>

        <label for="email">Email (optional)</label>
        <input type="email" id="email" placeholder="Enter your email">

        <label for="donationType">Donation Type</label>
        <select id="donationType" required>
            <option value="" disabled selected>Choose donation type</option>
            <option value="money">Money</option>
            <option value="items">Physical Items</option>
        </select>

        <!-- For Money Donations -->
        <div id="moneyFields" class="hidden">
            <label for="amount">Donation Amount (R)</label>
            <input type="number" id="amount" placeholder="Enter amount">

            <div class="bank-details">
                <p><strong>Bank:</strong> First National Bank (FNB)</p>
                <p><strong>Account Name:</strong> Alabaster Box Anointing Ministries</p>
                <p><strong>Account Number:</strong> 62123456789</p>
                <p><strong>Branch Code:</strong> 250655</p>
                <p><strong>Reference:</strong> Your Full Name / Purpose</p>
            </div>
        </div>

        <!-- For Item Donations -->
        <div id="itemFields" class="hidden">
            <label for="description">Item Description</label>
            <textarea id="description" placeholder="Describe your donation (e.g., 5 bags of clothes, canned food)"></textarea>

            <p>
                Drop-off Location:  
                <strong>2 Garden Crescent, New Germany, Pinetown, 3601</strong><br>
                <a href="https://www.google.com/maps/search/2+Garden+Crescent+New+Germany+Pinetown+3601"
                   target="_blank" style="color:#FFD700;">View on Google Maps</a>
            </p>
        </div>

        <button type="submit">Submit Donation</button>
    </form>

    <footer>
        <p>“Give, and it will be given to you.” – Luke 6:38</p>
    </footer>
</div>

<!-- ✅ Toast container -->
<div id="toast" class="toast"></div>

@section Scripts {
<!-- ✅ Firebase Setup -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBEjxaEf_S9x9NZhmJrWwHLDdZvoyDajDg",
  authDomain: "alabaster-8cfcd.firebaseapp.com",
  databaseURL: "https://alabaster-8cfcd-default-rtdb.firebaseio.com",
  projectId: "alabaster-8cfcd",
  storageBucket: "alabaster-8cfcd.firebasestorage.app",
  messagingSenderId: "1014314025942",
  appId: "1:1014314025942:web:fedff22641b2b8bd219a77",
  measurementId: "G-27PZK6GB89"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Toast helper function
function showToast(message, type = "success") {
    const toast = document.getElementById("toast");
    toast.textContent = message;
    toast.className = `toast show ${type}`;
    setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
}

// Handle donation type toggle
const donationType = document.getElementById("donationType");
const moneyFields = document.getElementById("moneyFields");
const itemFields = document.getElementById("itemFields");

donationType.addEventListener("change", () => {
    if (donationType.value === "money") {
        moneyFields.classList.remove("hidden");
        itemFields.classList.add("hidden");
    } else if (donationType.value === "items") {
        moneyFields.classList.add("hidden");
        itemFields.classList.remove("hidden");
    }
});

// Handle form submission
document.getElementById("donationForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const name = document.getElementById("name").value;
    const email = document.getElementById("email").value;
    const type = donationType.value;
    const amount = document.getElementById("amount").value;
    const description = document.getElementById("description").value;
    const date = new Date().toLocaleString();

    const donationData = {
        name,
        email,
        type,
        amount: type === "money" ? amount : "",
        description: type === "items" ? description : "",
        date
    };

    try {
        await db.ref("Donations").push(donationData);
        showToast("🙏 Thank you! Your donation was recorded successfully.", "success");
        document.getElementById("donationForm").reset();
        moneyFields.classList.add("hidden");
        itemFields.classList.add("hidden");
    } catch (error) {
        console.error(error);
        showToast("⚠️ Error submitting donation. Please try again.", "error");
    }
});
</script>
}
