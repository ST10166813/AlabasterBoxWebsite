@using Microsoft.AspNetCore.Http 
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>@ViewData["Title"]</title>

  <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
  <link rel="stylesheet" href="~/Alabaster.styles.css" asp-append-version="true" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
  <link href="https://fonts.googleapis.com/css2?family=Lexend+Giga:wght@400;500;600;700;800&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Unified, responsive header height */
      --nav-h: clamp(68px, 12vw, 110px);
    }

    /* =================== GLOBAL =================== */
    html, body { margin:0; padding:0; width:100%; min-height:100%; overflow-x:hidden; overflow-y:auto; background:transparent !important; }
    body{
      font-family:"Lexend Giga","Poppins",system-ui,sans-serif;
      background:url('../images/cross7.png') center -10% / cover no-repeat fixed;
      color:#fff; position:relative;
    }

    /* Hide any old nav/footer */
    .navbar, footer, .footer, .bottom-nav{ display:none !important; }

    /* =================== FULLSCREEN SPLINE =================== */
    spline-viewer{
      position:fixed; inset:0; width:100vw; height:100vh; z-index:-2;
      border:none; object-fit:cover; background:transparent !important; pointer-events:auto;
    }
    spline-viewer::part(branding){ display:none !important; }

    /* =================== GLOBAL PARTICLES =================== */
    #particles { position: fixed; inset: 0; pointer-events: none; overflow: hidden; z-index: 0; }
    .particle {
      position: absolute; background: rgba(247, 246, 244, 0.8);
      border-radius: 50%; filter: blur(2px);
      animation: float 12s linear infinite; will-change: transform, opacity;
    }
    @@keyframes float{
      0%{ transform: translateY(100vh) translateX(0) rotate(0deg); opacity:0; }
      10%{ opacity:1; }
      100%{ transform: translateY(-10vh) translateX(50vw) rotate(360deg); opacity:0; }
    }

    /* ===== Glass header rail that reserves space (prevents overlap) ===== */
    .nav-guard{
      position:fixed; top:0; left:0; right:0; height:var(--nav-h); z-index:1000;
      background:linear-gradient(180deg, rgba(8,8,10,.78), rgba(16,16,20,.62) 60%, rgba(16,16,20,0));
      border-bottom:1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(14px) saturate(140%);
      -webkit-backdrop-filter: blur(14px) saturate(140%);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      transition: height .25s ease, background .25s ease, box-shadow .25s ease;
      pointer-events:none;
    }
    body.scrolled .nav-guard{
      height: calc(var(--nav-h) - 16px);
      background:linear-gradient(180deg, rgba(8,8,10,.86), rgba(16,16,20,.72) 60%, rgba(16,16,20,0));
      box-shadow: 0 14px 36px rgba(0,0,0,.45);
    }

    /* =================== TOP NAV (fixed center links) =================== */
    .top-words{
      position:fixed; left:50%; transform:translateX(-50%);
      top: calc( (var(--nav-h) - 28px) / 2 ); /* vertically centers inside rail */
      display:flex; gap:clamp(18px,4vw,70px); z-index:1002; font-weight:600; text-transform:uppercase;
      white-space:nowrap; transition: top .25s ease;
    }
    body.scrolled .top-words{
      top: calc( (var(--nav-h) - 16px - 28px) / 2 );
    }
    .top-words a{ color:#f1f1f1; text-decoration:none; transition:opacity .2s, transform .15s; opacity:.9; }
    .top-words a:hover{ opacity:1; transform:translateY(-1px); }

    /* Right-side auth area */
    .auth-links{
      position:fixed; right:20px;
      top: calc( (var(--nav-h) - 32px) / 2 );
      z-index:1002; display:flex; gap:16px; align-items:center;
      font-weight:600; text-transform:uppercase; transition: top .25s ease;
    }
    body.scrolled .auth-links{
      top: calc( (var(--nav-h) - 16px - 32px) / 2 );
    }
    .auth-links a, .auth-links span{ color:#f1f1f1; text-decoration:none; transition:opacity .2s; opacity:.9; }
    .auth-links a:hover{ opacity:1; }

    /* Content wrapper (leave space for fixed nav) */
    .page-wrapper{
      position:relative; z-index:1; width:100%; min-height:100vh;
      padding-top: calc(var(--nav-h) + 16px); /* ensures titles never hide under the fixed nav */
      background:transparent !important;
      transition: padding-top .25s ease;
    }
    body.scrolled .page-wrapper{
      padding-top: calc(var(--nav-h));
    }

    /* Top fade (aesthetic) */
    .top-fade{
      position:fixed; inset:0 0 auto 0; height:110px; z-index:1; pointer-events:none;
      background:linear-gradient(to bottom, rgba(0,0,0,.85), rgba(0,0,0,.55) 40%, rgba(0,0,0,0) 100%);
    }

    /*BLACK GLASS HAMBURGER */ 
    .hamburger-icon{
      position:fixed; top:18px; left:18px; z-index:1055;
      display:inline-flex; align-items:center; justify-content:center;
      width:56px; height:56px; border-radius:14px; cursor:pointer; user-select:none;
      background:linear-gradient(180deg, rgba(10,10,12,.82), rgba(18,18,22,.72));
      border:1px solid rgba(255,255,255,.12);
      -webkit-backdrop-filter: blur(14px) saturate(140%); backdrop-filter: blur(14px) saturate(140%);
      box-shadow:0 10px 28px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);
      color:#f5f5f5; font-size:0; transition: transform .15s, box-shadow .2s, background .2s, border-color .2s;
      z-index:1003;
    }
    .hamburger-icon::before, .hamburger-icon::after{
      content:""; position:absolute; width:26px; height:2px; border-radius:2px; background:rgba(255,255,255,.92);
      box-shadow: 0 7px 0 0 rgba(255,255,255,.92), 0 -7px 0 0 rgba(255,255,255,.92);
    }
    .hamburger-icon:hover{ transform:scale(1.05); border-color:rgba(255,255,255,.18); box-shadow:0 14px 36px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.1); }
    .hamburger-icon:active{ transform:scale(.98); }

    /* =========================================================
       SIDE DRAWER — BLACK GLASS
       ========================================================= */
    .side-drawer{
      position:fixed; top:0; left:0; height:100dvh; width:0; z-index:1100; overflow:hidden;
      transition:width .35s ease;
      background:linear-gradient(180deg, rgba(10,10,12,.86), rgba(16,16,20,.78) 40%, rgba(10,10,12,.86));
      -webkit-backdrop-filter: blur(18px) saturate(150%); backdrop-filter: blur(18px) saturate(150%);
      border-right:1px solid rgba(255,255,255,.12);
      box-shadow:6px 0 42px rgba(0,0,0,.45);
      border-radius:0 16px 16px 0;
      display:grid; grid-template-rows:auto 1fr auto;
    }
    .side-drawer-header{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 16px; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-bottom:1px solid rgba(255,255,255,.12); color:#f1f1f1; font-weight:800; letter-spacing:.3px;
      box-shadow: 0 6px 28px rgba(0,0,0,.25);
    }
    .close-btn{
      display:inline-flex; align-items:center; justify-content:center;
      width:40px; height:40px; border-radius:10px; cursor:pointer;
      background:rgba(255,255,255,.08); color:#f1f1f1; border:1px solid rgba(255,255,255,.14);
      transition: transform .15s, background .2s, border-color .2s;
    }
    .close-btn:hover{ transform:scale(1.05); background:rgba(255,255,255,.14); border-color:rgba(255,255,255,.2); }

    .menu-links{ overflow-y:auto; padding:10px 10px 16px; }
    .drawer-section{ padding:8px 12px; margin:6px 6px 2px; font-size:.8rem; letter-spacing:.5px; color:rgba(255,255,255,.72); text-transform:uppercase; font-weight:700; }

    .menu-item{
      display:flex; align-items:center; gap:10px; padding:12px 14px; margin:6px 6px;
      border-radius:12px; color:#f1f1f1; text-decoration:none;
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.1); box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
      transition: transform .15s, background .2s, border-color .2s, box-shadow .2s, color .2s;
    }
    .menu-item i{ opacity:.9; }
    .menu-item:hover{
      transform: translateX(4px);
      background:linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
      border-color:rgba(255,255,255,.18); box-shadow:0 10px 26px rgba(0,0,0,.35); color:#fff;
    }
    .menu-item.active{ border-color:rgba(255,215,0,.42); box-shadow: 0 0 0 3px rgba(255,215,0,.12) inset, 0 14px 36px rgba(0,0,0,.45); }

    .drawer-logo{ padding:16px; text-align:center; border-top:1px solid rgba(255,255,255,.12);
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); }
    .drawer-logo img{ display:block; margin:0 auto; max-width:72%; border-radius:12px; }

    .overlay{ position:fixed; inset:0; z-index:1090; display:none; background:rgba(0,0,0,.45); -webkit-backdrop-filter: blur(2px); backdrop-filter: blur(2px); }

    /* =================== CONTENT & ANCHOR BEHAVIOR =================== */
    /* Prevent anchor targets (e.g., #section) from being hidden under the fixed header */
    :is(h1,h2,h3,h4,h5,h6,[id]){ scroll-margin-top: calc(var(--nav-h) + 24px); }

    /* =================== RESPONSIVE TWEAKS =================== */
    @@media (max-width:640px){
      .hamburger-icon{ width:52px; height:52px; }
      .top-words{ gap:20px; font-size:.92rem; }
    }
  </style>

  @RenderSection("Styles", required: false)
</head>
<body>
  <!-- Glass header rail to reserve visual space for the fixed nav -->
  <div class="nav-guard" aria-hidden="true"></div>

  <!-- Spline Background -->
  <script type="module" src="https://unpkg.com/@@splinetool/viewer@1.10.85/build/spline-viewer.js"></script>
  <spline-viewer loading-anim-type="none" url="https://prod.spline.design/IklUESOTGHIJ0hhn/scene.splinecode"></spline-viewer>

  <!-- Global Particles Layer -->
  <div id="particles" aria-hidden="true"></div>

  <!-- Top fade strip so content never visually collides with nav -->
  <div class="top-fade" aria-hidden="true"></div>

  <!-- Black-glass hamburger -->
  <button class="hamburger-icon" aria-label="Open menu" onclick="openDrawer()"></button>

  <!-- Center nav (switches for admin) -->
  @{
      var isAdmin = Context.Session.GetString("IsAdmin") == "true";
  }
  <nav class="top-words" aria-label="Primary">
    @if (isAdmin)
    {

        <!-- Regular menu -->
        <a href="/">Home</a>
        <a href="/AboutUs">About Us</a>
        <a href="/Events">Events</a>
        <a href="/Events/Volunteer">Volunteer</a>
        <a href="/Testimonies">Testimonies</a>
        <a href="/Prayer/Index">Prayer Requests</a>
    }
    else
    {
        <!-- Regular menu -->
        <a href="/">Home</a>
        <a href="/AboutUs">About Us</a>
        <a href="/Events">Events</a>
        <a href="/Events/Volunteer">Volunteer</a>
        <a href="/Testimonies">Testimonies</a>
        <a href="/Prayer/Index">Prayer Requests</a>

    }
  </nav>

  <!-- Auth links -->
  <div class="auth-links">
    @if (Context.Session.GetString("FirebaseToken") != null)
    {
      var displayName = Context.Session.GetString("UserName") ?? "User";
      <span>@displayName</span>
      <a asp-controller="Auth" asp-action="Logout">Logout</a>
    }
    else
    {
      <a asp-controller="Auth" asp-action="Login">Login</a>
      <a asp-controller="Auth" asp-action="Register">Register</a>
    }
  </div>

  <!-- Side Drawer (same switching logic) -->
  <div id="sideDrawer" class="side-drawer" aria-hidden="true" aria-label="App menu">
    <div class="side-drawer-header">
      <span>Menu</span>
      <button class="close-btn" aria-label="Close menu" onclick="closeDrawer()"><i class="bi bi-x-lg"></i></button>
    </div>

    <div class="menu-links">
      @if (isAdmin)
      {
        <div class="drawer-section">Admin</div>
        <a class="menu-item" asp-controller="Prayer" asp-action="AdminView"><i class="bi bi-journal-bookmark-fill"></i> Prayer Requests</a>
        <a class="menu-item" asp-controller="Events" asp-action="AddEvent"><i class="bi bi-calendar-plus"></i> Add Events</a>
        <a class="menu-item" asp-controller="Testimonies" asp-action="Admin"><i class="bi bi-chat-heart-fill"></i> Manage Testimonies</a>
        <a class="menu-item" asp-controller="Events" asp-action="ManageVolunteers"><i class="bi bi-people-fill"></i> Manage Volunteers</a>

        <div class="drawer-section">Main</div>
        <a class="menu-item" asp-controller="Home" asp-action="Index"><i class="bi bi-house-door"></i> Home</a>
        <a class="menu-item" asp-controller="AboutUs" asp-action="Index"><i class="bi bi-info-circle"></i> About Us</a>
        <a class="menu-item" asp-controller="Events" asp-action="Index"><i class="bi bi-calendar-event"></i> Events</a>
        <a class="menu-item" asp-controller="Events" asp-action="Volunteer"><i class="bi bi-people"></i> Volunteer</a>
        <a class="menu-item" asp-controller="Testimonies" asp-action="Index"><i class="bi bi-chat-quote"></i> Testimonies</a>
        <a class="menu-item" asp-controller="Prayer" asp-action="Index"><i class="bi bi-journal"></i> Prayer</a>
        <a class="menu-item" asp-controller="Donate" asp-action="Index"><i class="bi bi-heart"></i> Donate</a>

      }
      else
      {
        <a class="menu-item" asp-controller="Home" asp-action="Index"><i class="bi bi-house-door"></i> Home</a>
        <a class="menu-item" asp-controller="AboutUs" asp-action="Index"><i class="bi bi-info-circle"></i> About Us</a>
        <a class="menu-item" asp-controller="Events" asp-action="Index"><i class="bi bi-calendar-event"></i> Events</a>
        <a class="menu-item" asp-controller="Events" asp-action="Volunteer"><i class="bi bi-people"></i> Volunteer</a>
        <a class="menu-item" asp-controller="Testimonies" asp-action="Index"><i class="bi bi-chat-quote"></i> Testimonies</a>
        <a class="menu-item" asp-controller="Prayer" asp-action="Index"><i class="bi bi-journal"></i> Prayer</a>
        <a class="menu-item" asp-controller="Donate" asp-action="Index"><i class="bi bi-heart"></i> Donate</a>

      }
    </div>

    <div class="drawer-logo">
      <img src="~/Images/whitelogo.png" alt="Ministry Logo" />
    </div>
  </div>

  <div id="menuOverlay" class="overlay" onclick="closeDrawer()"></div>

  <!-- Page -->
  <div class="page-wrapper">
    <main role="main" class="pb-3">
      @RenderBody()
    </main>
  </div>

  <script src="~/lib/jquery/dist/jquery.min.js"></script>
  <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="~/js/site.js" asp-append-version="true"></script>
  @await RenderSectionAsync("Scripts", required: false)
  <script type="module" src="~/js/firebase-init.js"></script>

  <script>
    /* =================== Drawer controls =================== */
    function openDrawer(){
      const drawer = document.getElementById('sideDrawer');
      const overlay = document.getElementById('menuOverlay');
      drawer.style.width = '340px';
      overlay.style.display = 'block';
      drawer.setAttribute('aria-hidden','false');
    }
    function closeDrawer(){
      const drawer = document.getElementById('sideDrawer');
      const overlay = document.getElementById('menuOverlay');
      drawer.style.width = '0';
      overlay.style.display = 'none';
      drawer.setAttribute('aria-hidden','true');
    }

    /* =================== Global Particles (init once) =================== */
    (function () {
      if (window.__particlesInit) return; // prevent duplicates
      window.__particlesInit = true;

      let container = document.getElementById('particles');
      if (!container) {
        container = document.createElement('div');
        container.id = 'particles';
        container.setAttribute('aria-hidden', 'true');
        document.body.prepend(container);
      }

      const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (prefersReduced) return; // respect user motion preference

      function createParticle() {
        const p = document.createElement('div');
        p.className = 'particle';
        const size = Math.random() * 6 + 2; // 2px–8px
        p.style.width = size + 'px';
        p.style.height = size + 'px';
        p.style.left = Math.random() * window.innerWidth + 'px';
        p.style.animationDuration = (5 + Math.random() * 10) + 's';
        p.style.background = 'rgba(255,215,0,' + (Math.random() * 0.6 + 0.3).toFixed(2) + ')';
        container.appendChild(p);
        setTimeout(() => p.remove(), 15000);
      }

      window.__particlesInterval = setInterval(createParticle, 150);
      window.addEventListener('pagehide', () => clearInterval(window.__particlesInterval));
    })();

    /* =================== Scroll handler: toggles shrink and keeps spacing aligned =================== */
    (function(){
      function onScroll(){
        if (window.scrollY > 8) document.body.classList.add('scrolled');
        else document.body.classList.remove('scrolled');
      }
      onScroll();
      window.addEventListener('scroll', onScroll, { passive:true });
    })();
  </script>
</body>
</html>
